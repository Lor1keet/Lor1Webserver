<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ciallo</title>
  <style>
    :root{
      --blue:#0a57ff; --text:#1b1f2a; --muted:#6b7283;
      --card:#ffffff; --card-top:#f6f8fc; --border:#e5e7ef;
      --shadow: 0 10px 30px rgba(0,0,0,.20); --error:#e5484d;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;background:#0b0f16}
    .wrap{min-height:100%;display:grid;place-items:center;padding:24px;background:
      radial-gradient(800px 500px at 20% -10%, rgba(80,120,255,.12), transparent 60%),
      radial-gradient(700px 400px at 110% 10%, rgba(10,87,255,.10), transparent 55%),
      linear-gradient(180deg, #0e1117, #0b0f16);}
    .card{width:100%;max-width:380px;background:var(--card);border:1px solid var(--border);
      border-radius:12px;overflow:hidden;box-shadow:var(--shadow);}
    .brand{display:flex;align-items:center;gap:12px;padding:16px 18px;background:var(--card-top);border-bottom:1px solid var(--border)}
    .logo{width:40px;height:30px}
    .brand b{font-weight:800;color:#20263a}
    .brand small{display:block;color:#7b8397}
    .tabs{display:flex;gap:24px;padding:0 18px;border-bottom:1px solid var(--border)}
    .tab{position:relative;padding:12px 0;font-size:14px;color:#7b8397}
    .tab.active{color:#20263a;font-weight:600}
    .tab.active::after{content:"";position:absolute;left:0;right:0;bottom:0;height:2px;background:#20263a;border-radius:2px}
    form{padding:16px 18px 18px;display:grid;gap:12px}
    .field{display:grid;gap:6px}
    label{font-size:13px;color:#4b5162}
    .control{position:relative}
    .icon{position:absolute;left:10px;top:50%;transform:translateY(-50%);color:#8b93a8;width:18px;height:18px;pointer-events:none}
    input{width:100%;padding:12px 12px 12px 38px;border:1px solid var(--border);border-radius:8px;background:#fff;color:var(--text);font-size:15px;outline:none;transition:border-color .15s, box-shadow .15s}
    input:focus{border-color:#b9c7ff;box-shadow:0 0 0 3px rgba(10,87,255,.15)}
    .eye{position:absolute;right:8px;top:50%;transform:translateY(-50%);width:34px;height:34px;border:0;background:transparent;color:#8b93a8;border-radius:8px;cursor:pointer}
    .row{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-top:2px}
    .link{font-size:13px;color:#4b79ff;text-decoration:none}
    .link:hover{text-decoration:underline}
    .btn{width:100%;display:inline-flex;justify-content:center;align-items:center;gap:8px;padding:12px 14px;border-radius:8px;border:1px solid transparent;font-weight:700;letter-spacing:.2px;cursor:pointer;transition:filter .15s,transform .04s}
    .btn:active{transform:translateY(1px)}
    .btn-primary{background:var(--blue);color:#fff;border-color:var(--blue);box-shadow:0 8px 18px rgba(10,87,255,.25), inset 0 -2px 0 rgba(0,0,0,.12)}
    .btn-outline{background:#fff;color:#2a2f3c;border-color:#cfd6e6}
    .error{display:none;color:var(--error);font-size:12px}
    .field.invalid .error{display:block}
    .note{padding:12px 18px;font-size:12px;color:#7b8397;border-top:1px solid var(--border);background:#fafbfe}
    @media (max-width:380px){.brand{padding:14px}.tabs{padding:0 14px}form{padding:14px}.note{padding:10px 14px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="region" aria-labelledby="title">
      <div class="brand">
        <svg class="logo" viewBox="0 0 64 48" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <defs>
            <linearGradient id="g1" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0" stop-color="#FFD100"/><stop offset="1" stop-color="#E2B800"/>
            </linearGradient>
            <linearGradient id="g2" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0" stop-color="#0a57ff"/><stop offset="1" stop-color="#0a49d6"/>
            </linearGradient>
          </defs>
          <rect x="4" y="8" width="8" height="32" rx="2" fill="url(#g1)"/>
          <path d="M16 8h32a4 4 0 0 1 4 4v24a4 4 0 0 1-4 4H16z" fill="url(#g2)"/>
        </svg>
        <div>
          <b id="title">Ciallo</b>
        </div>
      </div>

      <form id="authForm" method="post" action="welcome" novalidate>
        <div class="field" id="f-user">
          <label for="user">电子邮箱或用户名</label>
          <div class="control">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24"><path d="M3 6h18v12H3z" fill="none" stroke="currentColor" stroke-width="1.8"/><path d="M3 7l9 6 9-6" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg>
            </span>
            <input id="user" name="user" type="text" inputmode="email"
                   placeholder="name@example.com 或 用户名"
                   autocomplete="username" required aria-describedby="e-user" />
          </div>
          <div class="error" id="e-user">请输入有效邮箱，或至少 3 个字符的用户名。</div>
        </div>

        <div class="field" id="f-password">
          <label for="password">密码</label>
          <div class="control">
            <span class="icon" aria-hidden="true">
              <svg viewBox="0 0 24 24"><rect x="3" y="10" width="18" height="10" rx="2" fill="none" stroke="currentColor" stroke-width="1.8"/><path d="M8 10V7a4 4 0 0 1 8 0v3" fill="none" stroke="currentColor" stroke-width="1.8"/></svg>
            </span>
            <input id="password" name="password" type="password" minlength="6"
                   placeholder="请输入密码" autocomplete="current-password"
                   required aria-describedby="e-password" />
            <button type="button" class="eye" id="togglePwd" aria-label="显示或隐藏密码" aria-pressed="false">
              <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                <path d="M2 12s3.5-6 10-6 10 6 10 6-3.5 6-10 6S2 12 2 12Z" fill="none" stroke="currentColor" stroke-width="2" opacity=".9"/>
                <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="2"/>
              </svg>
            </button>
          </div>
          <div class="error" id="e-password">密码至少 6 位。</div>
        </div>

        <button class="btn btn-primary" type="submit" name="op" value="login" id="loginBtn" disabled>登录</button>
        <button class="btn btn-outline" type="submit" name="op" value="register" id="registerBtn">注册</button>
      </form>

    </div>
  </div>

  <script>
    // 仅做前端校验与密码显隐，不拦截提交
    const form = document.getElementById('authForm');
    const user = document.getElementById('user');
    const password = document.getElementById('password');
    const fUser = document.getElementById('f-user');
    const fPassword = document.getElementById('f-password');
    const loginBtn = document.getElementById('loginBtn');
    const togglePwd = document.getElementById('togglePwd');

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i;
    const validUsername = v => v && v.length >= 3;

    function vUser(){
      const v = user.value.trim();
      const ok = emailRegex.test(v) || validUsername(v);
      fUser.classList.toggle('invalid', !ok);
      return ok;
    }
    function vPass(){
      const v = password.value;
      const ok = v && v.length >= 6;
      fPassword.classList.toggle('invalid', !ok);
      return ok;
    }
    function updateBtn(){
      loginBtn.disabled = !(vUser() && vPass());
    }
    user.addEventListener('input', updateBtn);
    password.addEventListener('input', updateBtn);
    updateBtn();

    togglePwd.addEventListener('click', () => {
      const isPwd = password.type === 'password';
      password.type = isPwd ? 'text' : 'password';
      togglePwd.setAttribute('aria-pressed', String(isPwd));
      togglePwd.innerHTML = isPwd
        ? '<svg viewBox="0 0 24 24" width="18" height="18"><path d="M3 3l18 18" stroke="currentColor" stroke-width="2"/><path d="M2 12s3.5-6 10-6c1.8 0 3.4.4 4.8 1" stroke="currentColor" stroke-width="2" opacity=".9"/><path d="M22 12s-3.5 6-10 6c-1.8 0-3.4-.4-4.8-1" stroke="currentColor" stroke-width="2" opacity=".9"/></svg>'
        : '<svg viewBox="0 0 24 24" width="18" height="18"><path d="M2 12s3.5-6 10-6 10 6 10 6-3.5 6-10 6S2 12 2 12Z" fill="none" stroke="currentColor" stroke-width="2" opacity=".9"/><circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="2"/></svg>';
      password.focus({preventScroll:true});
    });

    // 阻止未通过校验的提交（通过则让浏览器正常 POST）
    form.addEventListener('submit', (e) => {
      if (!(vUser() && vPass())) {
        e.preventDefault();
      }
    });

  </script>
</body>
</html>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const params = new URLSearchParams(window.location.search);
    if (params.get('error') === '1') {
        alert('登录失败：用户名或密码错误，请重新输入！');
        history.replaceState({}, document.title, window.location.pathname);
    }
    else if (params.get('registerok') === '1'){
        alert('注册成功！请重新登录');
        history.replaceState({}, document.title, window.location.pathname);
    }
    else if (params.get('user_exists') === '1'){
        alert('注册失败：用户已存在');
        history.replaceState({}, document.title, window.location.pathname);
    }
});
</script>